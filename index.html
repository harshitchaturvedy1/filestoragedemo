<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>1-Second Video Maker - Storage Saver Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f1724;
      color: #e6eef8;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: #0b1320;
      border-radius: 12px;
      padding: 20px;
    }
    input, button {
      margin-top: 10px;
      padding: 10px;
      border-radius: 6px;
      border: none;
      font-size: 16px;
    }
    button {
      background: #60a5fa;
      color: white;
      cursor: pointer;
    }
    #previewFrame {
      margin-top: 20px;
      max-width: 100%;
      border-radius: 8px;
      display: none;
    }
  </style>
</head>

<body>
<div class="container">

<h2>ðŸ“¸ 1-Second Video Generator (30 Photos â†’ 30fps)</h2>

<input type="file" id="imageInput" accept="image/*" multiple>

<button onclick="generateVideo()">Generate 1-Second Video</button>

<p id="status"></p>

<h3>ðŸ“Š File Size Comparison</h3>
<p id="sizeComparison"></p>

<h3>ðŸŽž Extracted Demo Frame</h3>
<img id="previewFrame" />

</div>

<!-- FFmpeg.js -->
<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>

<script>
async function generateVideo() {
  const files = document.getElementById('imageInput').files;
  const status = document.getElementById("status");

  if (files.length !== 30) {
    alert("Please upload exactly 30 photos.");
    return;
  }

  status.innerText = "Loading FFmpeg (first time takes a few seconds)...";

  const { createFFmpeg, fetchFile } = FFmpeg;
  const ffmpeg = createFFmpeg({ log: true });
  await ffmpeg.load();

  status.innerText = "Processing images...";

  // calculate total input size
  let totalImageSize = 0;
  for (let f of files) totalImageSize += f.size;

  // write images to memory
  for (let i = 0; i < 30; i++) {
    await ffmpeg.FS("writeFile", `img${String(i).padStart(2, '0')}.jpg`, await fetchFile(files[i]));
  }

  status.innerText = "Generating 1-sec video...";

  // motion blur filter
  const motionBlur = "minterpolate='fps=30:mi_mode=mci'";

  await ffmpeg.run(
    '-framerate', '30',
    '-i', 'img%02d.jpg',
    '-vf', motionBlur,
    '-t', '1',
    '-pix_fmt', 'yuv420p',
    'output.mp4'
  );

  const data = ffmpeg.FS("readFile", "output.mp4");

  // compare sizes
  const videoSize = data.length;
  document.getElementById("sizeComparison").innerHTML = `
    ðŸ“· Total image size: <b>${(totalImageSize/1024/1024).toFixed(2)} MB</b><br>
    ðŸŽ¬ Final video size: <b>${(videoSize/1024/1024).toFixed(2)} MB</b>
  `;

  // create video blob for download
  const videoBlob = new Blob([data.buffer], { type: 'video/mp4' });
  const videoURL = URL.createObjectURL(videoBlob);

  status.innerHTML = `Video ready: <a href="${videoURL}" download="1sec.mp4">Download 1-second video</a>`;

  // extract demo frame
  await ffmpeg.run(
    '-i', 'output.mp4',
    '-ss', '0.03',
    '-vframes', '1',
    'frame.jpg'
  );

  const frameData = ffmpeg.FS("readFile", "frame.jpg");
  const frameURL = URL.createObjectURL(new Blob([frameData.buffer], {type:"image/jpeg"}));

  const img = document.getElementById("previewFrame");
  img.src = frameURL;
  img.style.display = "block";
}
</script>

</body>
</html>
